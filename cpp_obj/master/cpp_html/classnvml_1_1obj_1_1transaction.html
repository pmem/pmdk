<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>NVML C++ bindings: nvml::obj::transaction Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.6 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li id="current"><a href="annotated.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<b>nvml</b>::<b>obj</b>::<a class="el" href="classnvml_1_1obj_1_1transaction.html">transaction</a></div>
<h1>nvml::obj::transaction Class Reference</h1><!-- doxytag: class="nvml::obj::transaction" -->C++ transaction handler class.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="transaction_8hpp-source.html">libpmemobj++/transaction.hpp</a>&gt;</code>
<p>
<a href="classnvml_1_1obj_1_1transaction-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnvml_1_1obj_1_1transaction.html#46009fb0543bf345a9a44f5204e0f922">~transaction</a> () noexcept</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Default destructor.  <a href="#46009fb0543bf345a9a44f5204e0f922"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnvml_1_1obj_1_1transaction.html#ee8b88da163e217c497da445fc3926e3">abort</a> (int err)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Manually abort the current transaction.  <a href="#ee8b88da163e217c497da445fc3926e3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnvml_1_1obj_1_1transaction.html#ce41b3ee17d015116aad061c68308017">commit</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Manually commit a transaction.  <a href="#ce41b3ee17d015116aad061c68308017"></a><br></td></tr>
<tr><td class="memTemplParams" nowrap colspan="2">template&lt;typename... Locks&gt; </td></tr>
<tr><td class="memTemplItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classnvml_1_1obj_1_1transaction.html#d5db0c171a217b0b896dc6e0937ced37">exec_tx</a> (<a class="el" href="classnvml_1_1obj_1_1pool__base.html">pool_base</a> &amp;<a class="el" href="classnvml_1_1obj_1_1pool.html">pool</a>, std::function&lt; void()&gt; tx, Locks &amp;...locks)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute a closure-like transaction and lock `locks`.  <a href="#d5db0c171a217b0b896dc6e0937ced37"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Static Private Member Functions</h2></td></tr>
<tr><td class="memTemplParams" nowrap colspan="2">template&lt;typename L, typename... Locks&gt; </td></tr>
<tr><td class="memTemplItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classnvml_1_1obj_1_1transaction.html#1dedabc722ce844d5cb48c0e454d2116">add_lock</a> (L &amp;lock, Locks &amp;...locks) noexcept</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Recursively add locks to the active transaction.  <a href="#1dedabc722ce844d5cb48c0e454d2116"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="5d76f77b04cb894197d749eef19b51fb"></a><!-- doxytag: member="nvml::obj::transaction::add_lock" ref="5d76f77b04cb894197d749eef19b51fb" args="() noexcept" -->
static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnvml_1_1obj_1_1transaction.html#5d76f77b04cb894197d749eef19b51fb">add_lock</a> () noexcept</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Method ending the recursive algorithm. <br></td></tr>
<tr><td colspan="2"><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnvml_1_1obj_1_1transaction_1_1automatic.html">automatic</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">C++ automatic scope transaction class.  <a href="classnvml_1_1obj_1_1transaction_1_1automatic.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">class &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classnvml_1_1obj_1_1transaction_1_1manual.html">manual</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">C++ manual scope transaction class.  <a href="classnvml_1_1obj_1_1transaction_1_1manual.html#_details">More...</a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
C++ transaction handler class. 
<p>
This class is the pmemobj transaction handler. Scoped transactions are handled through two internal classes: <a class="el" href="classnvml_1_1obj_1_1transaction_1_1manual.html">manual</a> and <a class="el" href="classnvml_1_1obj_1_1transaction_1_1automatic.html">automatic</a>.<ul>
<li><a class="el" href="classnvml_1_1obj_1_1transaction_1_1manual.html">manual</a> transactions need to be committed manually, otherwise they will be aborted on object destruction.<br>
</li><li><a class="el" href="classnvml_1_1obj_1_1transaction_1_1automatic.html">automatic</a> transactions are only available in C++17. They handle transaction commit/abort automatically.</li></ul>
<p>
This class also exposes a closure-like transaction API, which is the preferred way of handling transactions.<p>
The typical usage example would be:  doc_snippets/transaction.cpp general_tx_example 
<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="46009fb0543bf345a9a44f5204e0f922"></a><!-- doxytag: member="nvml::obj::transaction::~transaction" ref="46009fb0543bf345a9a44f5204e0f922" args="() noexcept" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">nvml::obj::transaction::~transaction           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Default destructor. 
<p>
End pmemobj transaction. If the transaction has not been committed before object destruction, an abort will be issued.     </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="ee8b88da163e217c497da445fc3926e3"></a><!-- doxytag: member="nvml::obj::transaction::abort" ref="ee8b88da163e217c497da445fc3926e3" args="(int err)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void nvml::obj::transaction::abort           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>err</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Manually abort the current transaction. 
<p>
If called within an inner transaction, the outer transactions will also be aborted.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>err</em>&nbsp;</td><td>the error to be reported as the reason of the abort.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classnvml_1_1transaction__error.html">transaction_error</a></em>&nbsp;</td><td>if the transaction is in an invalid state. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classnvml_1_1manual__tx__abort.html">manual_tx_abort</a></em>&nbsp;</td><td>this exception is thrown to signify a transaction abort. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="1dedabc722ce844d5cb48c0e454d2116"></a><!-- doxytag: member="nvml::obj::transaction::add_lock" ref="1dedabc722ce844d5cb48c0e454d2116" args="(L &amp;lock, Locks &amp;...locks) noexcept" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="mdPrefix" colspan="4">
template&lt;typename L, typename... Locks&gt; </td>
        </tr>
        <tr>
          <td class="md" nowrap valign="top">static int nvml::obj::transaction::add_lock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">L &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>lock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>Locks &amp;...&nbsp;</td>
          <td class="mdname" nowrap> <em>locks</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline, static, private]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Recursively add locks to the active transaction. 
<p>
The locks are taken in the provided order.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>lock</em>&nbsp;</td><td>the lock to add. </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>locks</em>&nbsp;</td><td>the rest of the locks to be added to the active transaction.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>error number if adding any of the locks failed, 0 otherwise. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ce41b3ee17d015116aad061c68308017"></a><!-- doxytag: member="nvml::obj::transaction::commit" ref="ce41b3ee17d015116aad061c68308017" args="()" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void nvml::obj::transaction::commit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Manually commit a transaction. 
<p>
It is the sole responsibility of the caller, that after the call to <a class="el" href="classnvml_1_1obj_1_1transaction.html#ce41b3ee17d015116aad061c68308017">transaction::commit()</a> no other operations are done within the transaction.<p>
<dl compact><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classnvml_1_1transaction__error.html">transaction_error</a></em>&nbsp;</td><td>on any errors with ending the transaction. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="d5db0c171a217b0b896dc6e0937ced37"></a><!-- doxytag: member="nvml::obj::transaction::exec_tx" ref="d5db0c171a217b0b896dc6e0937ced37" args="(pool_base &amp;pool, std::function&lt; void()&gt; tx, Locks &amp;...locks)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="mdPrefix" colspan="4">
template&lt;typename... Locks&gt; </td>
        </tr>
        <tr>
          <td class="md" nowrap valign="top">static void nvml::obj::transaction::exec_tx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classnvml_1_1obj_1_1pool__base.html">pool_base</a> &amp;&nbsp;</td>
          <td class="mdname" nowrap> <em>pool</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>std::function&lt; void()&gt;&nbsp;</td>
          <td class="mdname" nowrap> <em>tx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>Locks &amp;...&nbsp;</td>
          <td class="mdname" nowrap> <em>locks</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Execute a closure-like transaction and lock `locks`. 
<p>
The locks have to be persistent memory resident locks. An attempt to lock the locks will be made. If any of the specified locks is already locked, the method will block. The locks are held until the end of the transaction. The transaction does not have to be committed manually. Manual aborts will end the transaction with an active exception.<p>
If an exception is thrown within the transaction, it gets aborted and the exception is rethrown. Therefore extra care has to be taken with proper error handling.<p>
The locks are held for the entire duration of the transaction. They are released at the end of the scope, so within the `catch` block, they are already unlocked. If the cleanup action requires access to data within a critical section, the locks have to be manually acquired once again.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>pool</em>&nbsp;</td><td>the pool in which the transaction will take place. </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>tx</em>&nbsp;</td><td>an std::function&lt;void ()&gt; which will perform operations within this transaction. </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>locks</em>&nbsp;</td><td>locks to be taken for the duration of the transaction.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Exceptions:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classnvml_1_1transaction__error.html">transaction_error</a></em>&nbsp;</td><td>on any error pertaining the execution of the transaction. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="classnvml_1_1manual__tx__abort.html">manual_tx_abort</a></em>&nbsp;</td><td>on manual transaction abort. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following file:<ul>
<li>nvml/src/include/libpmemobj++/<a class="el" href="transaction_8hpp-source.html">transaction.hpp</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Tue Sep 6 08:21:33 2016 for NVML C++ bindings by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6 </small></address>
</body>
</html>
