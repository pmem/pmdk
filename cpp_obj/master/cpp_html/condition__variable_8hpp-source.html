<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>NVML C++ bindings: nvml/src/include/libpmemobj++/condition_variable.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.6 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>nvml/src/include/libpmemobj++/condition_variable.hpp</h1><a href="condition__variable_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright 2016, Intel Corporation</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00005"></a>00005 <span class="comment"> * modification, are permitted provided that the following conditions</span>
<a name="l00006"></a>00006 <span class="comment"> * are met:</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> *     * Redistributions of source code must retain the above copyright</span>
<a name="l00009"></a>00009 <span class="comment"> *       notice, this list of conditions and the following disclaimer.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00012"></a>00012 <span class="comment"> *       notice, this list of conditions and the following disclaimer in</span>
<a name="l00013"></a>00013 <span class="comment"> *       the documentation and/or other materials provided with the</span>
<a name="l00014"></a>00014 <span class="comment"> *       distribution.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> *     * Neither the name of the copyright holder nor the names of its</span>
<a name="l00017"></a>00017 <span class="comment"> *       contributors may be used to endorse or promote products derived</span>
<a name="l00018"></a>00018 <span class="comment"> *       from this software without specific prior written permission.</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00021"></a>00021 <span class="comment"> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00022"></a>00022 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00023"></a>00023 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00024"></a>00024 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00025"></a>00025 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00026"></a>00026 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00027"></a>00027 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00028"></a>00028 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00029"></a>00029 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00030"></a>00030 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00031"></a>00031 <span class="comment"> */</span>
<a name="l00032"></a>00032 
<a name="l00038"></a>00038 <span class="preprocessor">#ifndef PMEMOBJ_CONDVARIABLE_HPP</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#define PMEMOBJ_CONDVARIABLE_HPP</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;chrono&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;condition_variable&gt;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include "<a class="code" href="conversions_8hpp.html">libpmemobj++/detail/conversions.hpp</a>"</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include "<a class="code" href="mutex_8hpp.html">libpmemobj++/mutex.hpp</a>"</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include "libpmemobj/thread.h"</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="keyword">namespace </span>nvml
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="keyword">namespace </span>obj
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053 
<a name="l00062"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html">00062</a> <span class="keyword">class </span><a class="code" href="classnvml_1_1obj_1_1condition__variable.html">condition_variable</a> {
<a name="l00063"></a>00063         <span class="keyword">typedef</span> std::chrono::system_clock clock_type;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="keyword">public</span>:
<a name="l00067"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#eb183f9e516523ad5b005fc8daf8ebc6">00067</a>         <span class="keyword">typedef</span> PMEMcond *<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#eb183f9e516523ad5b005fc8daf8ebc6">native_handle_type</a>;
<a name="l00068"></a>00068 
<a name="l00072"></a>00072         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#2b91e82e9994f61a51c3116efd3dd297">condition_variable</a>() noexcept = default;
<a name="l00073"></a>00073 
<a name="l00077"></a>00077         ~<a class="code" href="classnvml_1_1obj_1_1condition__variable.html">condition_variable</a>() = default;
<a name="l00078"></a>00078 
<a name="l00087"></a>00087         <span class="keywordtype">void</span>
<a name="l00088"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#ee8fa41f0baa2b5f3e62ae49adf38775">00088</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#ee8fa41f0baa2b5f3e62ae49adf38775">notify_one</a>()
<a name="l00089"></a>00089         {
<a name="l00090"></a>00090                 PMEMobjpool *pop = pmemobj_pool_by_ptr(<span class="keyword">this</span>);
<a name="l00091"></a>00091                 <span class="keywordflow">if</span> (<span class="keywordtype">int</span> ret = pmemobj_cond_signal(pop, &amp;this-&gt;pcond))
<a name="l00092"></a>00092                         <span class="keywordflow">throw</span> <a class="code" href="classnvml_1_1lock__error.html">lock_error</a>(ret, std::system_category(),
<a name="l00093"></a>00093                                          <span class="stringliteral">"Error notifying one on "</span>
<a name="l00094"></a>00094                                          <span class="stringliteral">"a condition variable."</span>);
<a name="l00095"></a>00095         }
<a name="l00096"></a>00096 
<a name="l00102"></a>00102         <span class="keywordtype">void</span>
<a name="l00103"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#43c77e5293d76e841ad3714653f507d2">00103</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#43c77e5293d76e841ad3714653f507d2">notify_all</a>()
<a name="l00104"></a>00104         {
<a name="l00105"></a>00105                 PMEMobjpool *pop = pmemobj_pool_by_ptr(<span class="keyword">this</span>);
<a name="l00106"></a>00106                 <span class="keywordflow">if</span> (<span class="keywordtype">int</span> ret = pmemobj_cond_broadcast(pop, &amp;this-&gt;pcond))
<a name="l00107"></a>00107                         <span class="keywordflow">throw</span> <a class="code" href="classnvml_1_1lock__error.html">lock_error</a>(ret, std::system_category(),
<a name="l00108"></a>00108                                          <span class="stringliteral">"Error notifying all on "</span>
<a name="l00109"></a>00109                                          <span class="stringliteral">"a condition variable."</span>);
<a name="l00110"></a>00110         }
<a name="l00111"></a>00111 
<a name="l00127"></a>00127         <span class="keywordtype">void</span>
<a name="l00128"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#b92729e5a91b915ed2bba89bfa52a627">00128</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#b92729e5a91b915ed2bba89bfa52a627">wait</a>(<a class="code" href="classnvml_1_1obj_1_1mutex.html">mutex</a> &amp;lock)
<a name="l00129"></a>00129         {
<a name="l00130"></a>00130                 this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#1bdb3f4d75c5e3ba7ab1ea8f7db80f51">wait_impl</a>(lock);
<a name="l00131"></a>00131         }
<a name="l00132"></a>00132 
<a name="l00150"></a>00150         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Lock&gt;
<a name="l00151"></a>00151         <span class="keywordtype">void</span>
<a name="l00152"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#8f0ddc994c9340c5701d54bc9cfbe0b0">00152</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#b92729e5a91b915ed2bba89bfa52a627">wait</a>(Lock &amp;lock)
<a name="l00153"></a>00153         {
<a name="l00154"></a>00154                 this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#1bdb3f4d75c5e3ba7ab1ea8f7db80f51">wait_impl</a>(*lock.mutex());
<a name="l00155"></a>00155         }
<a name="l00156"></a>00156 
<a name="l00176"></a>00176         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Predicate&gt;
<a name="l00177"></a>00177         <span class="keywordtype">void</span>
<a name="l00178"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#5e265138461e836d94a478fe1de4397a">00178</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#b92729e5a91b915ed2bba89bfa52a627">wait</a>(<a class="code" href="classnvml_1_1obj_1_1mutex.html">mutex</a> &amp;lock, Predicate pred)
<a name="l00179"></a>00179         {
<a name="l00180"></a>00180                 this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#1bdb3f4d75c5e3ba7ab1ea8f7db80f51">wait_impl</a>(lock, std::move(pred));
<a name="l00181"></a>00181         }
<a name="l00182"></a>00182 
<a name="l00204"></a>00204         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Lock, <span class="keyword">typename</span> Predicate&gt;
<a name="l00205"></a>00205         <span class="keywordtype">void</span>
<a name="l00206"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#08449a375796d5d4f199d22dbf3173bb">00206</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#b92729e5a91b915ed2bba89bfa52a627">wait</a>(Lock &amp;lock, Predicate pred)
<a name="l00207"></a>00207         {
<a name="l00208"></a>00208                 this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#1bdb3f4d75c5e3ba7ab1ea8f7db80f51">wait_impl</a>(*lock.mutex(), std::move(pred));
<a name="l00209"></a>00209         }
<a name="l00210"></a>00210 
<a name="l00232"></a>00232         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Clock, <span class="keyword">typename</span> Duration&gt;
<a name="l00233"></a>00233         std::cv_status
<a name="l00234"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#5bb2bf7e13b36464629f9256353c3254">00234</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#5bb2bf7e13b36464629f9256353c3254">wait_until</a>(<a class="code" href="classnvml_1_1obj_1_1mutex.html">mutex</a> &amp;lock,
<a name="l00235"></a>00235                    <span class="keyword">const</span> std::chrono::time_point&lt;Clock, Duration&gt; &amp;timeout)
<a name="l00236"></a>00236         {
<a name="l00237"></a>00237                 <span class="keywordflow">return</span> this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#9f6b1eb4236829d6e3c9716434b521d4">wait_until_impl</a>(lock, timeout);
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239 
<a name="l00263"></a>00263         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Lock, <span class="keyword">typename</span> Clock, <span class="keyword">typename</span> Duration&gt;
<a name="l00264"></a>00264         std::cv_status
<a name="l00265"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#be26a697dc8f0fed83005a053c370567">00265</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#5bb2bf7e13b36464629f9256353c3254">wait_until</a>(Lock &amp;lock,
<a name="l00266"></a>00266                    <span class="keyword">const</span> std::chrono::time_point&lt;Clock, Duration&gt; &amp;timeout)
<a name="l00267"></a>00267         {
<a name="l00268"></a>00268                 <span class="keywordflow">return</span> this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#9f6b1eb4236829d6e3c9716434b521d4">wait_until_impl</a>(*lock.mutex(), timeout);
<a name="l00269"></a>00269         }
<a name="l00270"></a>00270 
<a name="l00293"></a>00293         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Clock, <span class="keyword">typename</span> Duration, <span class="keyword">typename</span> Predicate&gt;
<a name="l00294"></a>00294         <span class="keywordtype">bool</span>
<a name="l00295"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#d724125fc10ffaaf227c7a5e90b953de">00295</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#5bb2bf7e13b36464629f9256353c3254">wait_until</a>(<a class="code" href="classnvml_1_1obj_1_1mutex.html">mutex</a> &amp;lock,
<a name="l00296"></a>00296                    <span class="keyword">const</span> std::chrono::time_point&lt;Clock, Duration&gt; &amp;timeout,
<a name="l00297"></a>00297                    Predicate pred)
<a name="l00298"></a>00298         {
<a name="l00299"></a>00299                 <span class="keywordflow">return</span> this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#9f6b1eb4236829d6e3c9716434b521d4">wait_until_impl</a>(lock, timeout, std::move(pred));
<a name="l00300"></a>00300         }
<a name="l00301"></a>00301 
<a name="l00326"></a>00326         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Lock, <span class="keyword">typename</span> Clock, <span class="keyword">typename</span> Duration,
<a name="l00327"></a>00327                   <span class="keyword">typename</span> Predicate&gt;
<a name="l00328"></a>00328         <span class="keywordtype">bool</span>
<a name="l00329"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#5377eb0f3638266ce12f771d8d4d6b33">00329</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#5bb2bf7e13b36464629f9256353c3254">wait_until</a>(Lock &amp;lock,
<a name="l00330"></a>00330                    <span class="keyword">const</span> std::chrono::time_point&lt;Clock, Duration&gt; &amp;timeout,
<a name="l00331"></a>00331                    Predicate pred)
<a name="l00332"></a>00332         {
<a name="l00333"></a>00333                 <span class="keywordflow">return</span> this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#9f6b1eb4236829d6e3c9716434b521d4">wait_until_impl</a>(*lock.mutex(), timeout,
<a name="l00334"></a>00334                                              std::move(pred));
<a name="l00335"></a>00335         }
<a name="l00336"></a>00336 
<a name="l00360"></a>00360         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Lock, <span class="keyword">typename</span> Rep, <span class="keyword">typename</span> Period&gt;
<a name="l00361"></a>00361         std::cv_status
<a name="l00362"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#90a78392d6ed3cc282c1f181d0953016">00362</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#90a78392d6ed3cc282c1f181d0953016">wait_for</a>(Lock &amp;lock, <span class="keyword">const</span> std::chrono::duration&lt;Rep, Period&gt; &amp;rel_time)
<a name="l00363"></a>00363         {
<a name="l00364"></a>00364                 <span class="keywordflow">return</span> this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#9f6b1eb4236829d6e3c9716434b521d4">wait_until_impl</a>(lock,
<a name="l00365"></a>00365                                              clock_type::now() + rel_time);
<a name="l00366"></a>00366         }
<a name="l00367"></a>00367 
<a name="l00392"></a>00392         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Lock, <span class="keyword">typename</span> Rep, <span class="keyword">typename</span> Period,
<a name="l00393"></a>00393                   <span class="keyword">typename</span> Predicate&gt;
<a name="l00394"></a>00394         <span class="keywordtype">bool</span>
<a name="l00395"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#163a8f85b971641ce125f22afd2272c5">00395</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#90a78392d6ed3cc282c1f181d0953016">wait_for</a>(Lock &amp;lock, <span class="keyword">const</span> std::chrono::duration&lt;Rep, Period&gt; &amp;rel_time,
<a name="l00396"></a>00396                  Predicate pred)
<a name="l00397"></a>00397         {
<a name="l00398"></a>00398                 <span class="keywordflow">return</span> this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#9f6b1eb4236829d6e3c9716434b521d4">wait_until_impl</a>(lock, clock_type::now() + rel_time,
<a name="l00399"></a>00399                                              std::move(pred));
<a name="l00400"></a>00400         }
<a name="l00401"></a>00401 
<a name="l00423"></a>00423         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Rep, <span class="keyword">typename</span> Period&gt;
<a name="l00424"></a>00424         std::cv_status
<a name="l00425"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#c5b94ac09b607e962b5a198d37aefa77">00425</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#90a78392d6ed3cc282c1f181d0953016">wait_for</a>(<a class="code" href="classnvml_1_1obj_1_1mutex.html">mutex</a> &amp;lock,
<a name="l00426"></a>00426                  <span class="keyword">const</span> std::chrono::duration&lt;Rep, Period&gt; &amp;rel_time)
<a name="l00427"></a>00427         {
<a name="l00428"></a>00428                 <span class="keywordflow">return</span> this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#9f6b1eb4236829d6e3c9716434b521d4">wait_until_impl</a>(lock,
<a name="l00429"></a>00429                                              clock_type::now() + rel_time);
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431 
<a name="l00454"></a>00454         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Rep, <span class="keyword">typename</span> Period, <span class="keyword">typename</span> Predicate&gt;
<a name="l00455"></a>00455         <span class="keywordtype">bool</span>
<a name="l00456"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#c2cc6231f767aa070f66d650426e5359">00456</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#90a78392d6ed3cc282c1f181d0953016">wait_for</a>(<a class="code" href="classnvml_1_1obj_1_1mutex.html">mutex</a> &amp;lock,
<a name="l00457"></a>00457                  <span class="keyword">const</span> std::chrono::duration&lt;Rep, Period&gt; &amp;rel_time,
<a name="l00458"></a>00458                  Predicate pred)
<a name="l00459"></a>00459         {
<a name="l00460"></a>00460                 <span class="keywordflow">return</span> this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#9f6b1eb4236829d6e3c9716434b521d4">wait_until_impl</a>(lock, clock_type::now() + rel_time,
<a name="l00461"></a>00461                                              std::move(pred));
<a name="l00462"></a>00462         }
<a name="l00463"></a>00463 
<a name="l00469"></a>00469         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#eb183f9e516523ad5b005fc8daf8ebc6">native_handle_type</a>
<a name="l00470"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#f0919ebbbc649722df21f4e65f16c41a">00470</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#f0919ebbbc649722df21f4e65f16c41a">native_handle</a>() noexcept
<a name="l00471"></a>00471         {
<a name="l00472"></a>00472                 <span class="keywordflow">return</span> &amp;this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#f8d73c2378bdb3a8c9e6ad71d1c7258b">pcond</a>;
<a name="l00473"></a>00473         }
<a name="l00474"></a>00474 
<a name="l00478"></a>00478         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html">condition_variable</a> &amp;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#aca283134206d2feeda21914ac415e9b">operator=</a>(<span class="keyword">const</span> <a class="code" href="classnvml_1_1obj_1_1condition__variable.html">condition_variable</a> &amp;) = <span class="keyword">delete</span>;
<a name="l00479"></a>00479 
<a name="l00483"></a>00483         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#2b91e82e9994f61a51c3116efd3dd297">condition_variable</a>(<span class="keyword">const</span> <a class="code" href="classnvml_1_1obj_1_1condition__variable.html">condition_variable</a> &amp;) = <span class="keyword">delete</span>;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 <span class="keyword">private</span>:
<a name="l00489"></a>00489         <span class="keywordtype">void</span>
<a name="l00490"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#1bdb3f4d75c5e3ba7ab1ea8f7db80f51">00490</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#1bdb3f4d75c5e3ba7ab1ea8f7db80f51">wait_impl</a>(<a class="code" href="classnvml_1_1obj_1_1mutex.html">mutex</a> &amp;lock)
<a name="l00491"></a>00491         {
<a name="l00492"></a>00492                 PMEMobjpool *pop = pmemobj_pool_by_ptr(<span class="keyword">this</span>);
<a name="l00493"></a>00493                 <span class="keywordflow">if</span> (<span class="keywordtype">int</span> ret = pmemobj_cond_wait(pop, &amp;this-&gt;pcond,
<a name="l00494"></a>00494                                                 lock.<a class="code" href="classnvml_1_1obj_1_1mutex.html#a0515116a3dc9f50fe0b2afbde25bc2e">native_handle</a>()))
<a name="l00495"></a>00495                         <span class="keywordflow">throw</span> <a class="code" href="classnvml_1_1lock__error.html">lock_error</a>(ret, std::system_category(),
<a name="l00496"></a>00496                                          <span class="stringliteral">"Error waiting on a condition "</span>
<a name="l00497"></a>00497                                          <span class="stringliteral">"variable."</span>);
<a name="l00498"></a>00498         }
<a name="l00499"></a>00499 
<a name="l00503"></a>00503         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Predicate&gt;
<a name="l00504"></a>00504         <span class="keywordtype">void</span>
<a name="l00505"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#eb7c3a325499fa60492d1012d96b358d">00505</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#1bdb3f4d75c5e3ba7ab1ea8f7db80f51">wait_impl</a>(<a class="code" href="classnvml_1_1obj_1_1mutex.html">mutex</a> &amp;lock, Predicate pred)
<a name="l00506"></a>00506         {
<a name="l00507"></a>00507                 <span class="keywordflow">while</span> (!pred())
<a name="l00508"></a>00508                         this-&gt;<a class="code" href="classnvml_1_1obj_1_1condition__variable.html#b92729e5a91b915ed2bba89bfa52a627">wait</a>(lock);
<a name="l00509"></a>00509         }
<a name="l00510"></a>00510 
<a name="l00514"></a>00514         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Clock, <span class="keyword">typename</span> Duration&gt;
<a name="l00515"></a>00515         std::cv_status
<a name="l00516"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#9f6b1eb4236829d6e3c9716434b521d4">00516</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#9f6b1eb4236829d6e3c9716434b521d4">wait_until_impl</a>(
<a name="l00517"></a>00517                 <a class="code" href="classnvml_1_1obj_1_1mutex.html">mutex</a> &amp;lock,
<a name="l00518"></a>00518                 <span class="keyword">const</span> std::chrono::time_point&lt;Clock, Duration&gt; &amp;abs_timeout)
<a name="l00519"></a>00519         {
<a name="l00520"></a>00520                 PMEMobjpool *pop = pmemobj_pool_by_ptr(<span class="keyword">this</span>);
<a name="l00521"></a>00521 
<a name="l00522"></a>00522                 <span class="comment">/* convert to my clock */</span>
<a name="l00523"></a>00523                 <span class="keyword">const</span> <span class="keyword">typename</span> Clock::time_point their_now = Clock::now();
<a name="l00524"></a>00524                 <span class="keyword">const</span> clock_type::time_point my_now = clock_type::now();
<a name="l00525"></a>00525                 <span class="keyword">const</span> <span class="keyword">auto</span> delta = abs_timeout - their_now;
<a name="l00526"></a>00526                 <span class="keyword">const</span> <span class="keyword">auto</span> my_rel = my_now + delta;
<a name="l00527"></a>00527 
<a name="l00528"></a>00528                 <span class="keyword">struct </span>timespec ts = detail::timepoint_to_timespec(my_rel);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530                 <span class="keyword">auto</span> ret = pmemobj_cond_timedwait(pop, &amp;this-&gt;pcond,
<a name="l00531"></a>00531                                                   lock.<a class="code" href="classnvml_1_1obj_1_1mutex.html#a0515116a3dc9f50fe0b2afbde25bc2e">native_handle</a>(), &amp;ts);
<a name="l00532"></a>00532 
<a name="l00533"></a>00533                 <span class="keywordflow">if</span> (ret == 0)
<a name="l00534"></a>00534                         <span class="keywordflow">return</span> std::cv_status::no_timeout;
<a name="l00535"></a>00535                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ret == ETIMEDOUT)
<a name="l00536"></a>00536                         <span class="keywordflow">return</span> std::cv_status::timeout;
<a name="l00537"></a>00537                 <span class="keywordflow">else</span>
<a name="l00538"></a>00538                         <span class="keywordflow">throw</span> <a class="code" href="classnvml_1_1lock__error.html">lock_error</a>(ret, std::system_category(),
<a name="l00539"></a>00539                                          <span class="stringliteral">"Error waiting on a condition "</span>
<a name="l00540"></a>00540                                          <span class="stringliteral">"variable."</span>);
<a name="l00541"></a>00541         }
<a name="l00542"></a>00542 
<a name="l00546"></a>00546         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Clock, <span class="keyword">typename</span> Duration, <span class="keyword">typename</span> Predicate&gt;
<a name="l00547"></a>00547         <span class="keywordtype">bool</span>
<a name="l00548"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#167f220a9fcea7fd97e2d9a4768f53c0">00548</a>         <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#9f6b1eb4236829d6e3c9716434b521d4">wait_until_impl</a>(
<a name="l00549"></a>00549                 <a class="code" href="classnvml_1_1obj_1_1mutex.html">mutex</a> &amp;lock,
<a name="l00550"></a>00550                 <span class="keyword">const</span> std::chrono::time_point&lt;Clock, Duration&gt; &amp;abs_timeout,
<a name="l00551"></a>00551                 Predicate pred)
<a name="l00552"></a>00552         {
<a name="l00553"></a>00553                 <span class="keywordflow">while</span> (!pred())
<a name="l00554"></a>00554                         <span class="keywordflow">if</span> (this-&gt;wait_until_impl(lock, abs_timeout) ==
<a name="l00555"></a>00555                             std::cv_status::timeout)
<a name="l00556"></a>00556                                 <span class="keywordflow">return</span> pred();
<a name="l00557"></a>00557                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00558"></a>00558         }
<a name="l00559"></a>00559 
<a name="l00561"></a><a class="code" href="classnvml_1_1obj_1_1condition__variable.html#f8d73c2378bdb3a8c9e6ad71d1c7258b">00561</a>         PMEMcond <a class="code" href="classnvml_1_1obj_1_1condition__variable.html#f8d73c2378bdb3a8c9e6ad71d1c7258b">pcond</a>;
<a name="l00562"></a>00562 };
<a name="l00563"></a>00563 
<a name="l00564"></a>00564 } <span class="comment">/* namespace obj */</span>
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 } <span class="comment">/* namespace nvml */</span>
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 <span class="preprocessor">#endif </span><span class="comment">/* PMEMOBJ_CONDVARIABLE_HPP */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Sep 6 08:21:33 2016 for NVML C++ bindings by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6 </small></address>
</body>
</html>
