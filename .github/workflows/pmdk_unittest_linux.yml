
name: pmdk_unittest_linux

on:
    workflow_dispatch:
        inputs:
            label:
                description: 'label of execution machine, for example dell004 or fedora34, remember to manually add labels on gha runners page.'
                required: true
                default: 'fedora34'
            test_folders:
                description: 'please select one: all, remotes, nonremotes'
                required: true
                default: 'all'
            test_type:
                description: 'please select one: check, short, medium, long, all'
                required: true
                default: 'check'
            test_build:
                description: 'please select one: debug, nondebug, static-debug, static-nondebug, all'
                required: true
                default: 'all'
            fs_type:
                description: 'please select one: all, pmem, non-pmem, any, none'
                required: true
                default: 'all'
            badblock:
                description: 'please select one: yes, no'
                required: true
                default: 'no'
            drd:
                description: 'please select one: auto, force-enable'
                required: true
                default: 'auto'
            memcheck:
                description: 'please select one: auto, force-enable'
                required: true
                default: 'auto'
            helgrind:
                description: 'please select one: auto, force-enable'
                required: true
                default: 'auto'
            dual_exec:
                description: 'please select one: nope, dbg_st-nondbg_vs_nondbg-st-dbg'
                required: true
                default: 'nope'
            email_recipients:
                description: 'optional: provide emails separated by comma to receive results..'
                required: false
                default: 'gk.pmdk.gb.val@intel.com'
            skip_tests:
                description: 'remove tests from scope, put spaces between tests.'
                required: false
                default: ''
            pmdk_libs:
                description: 'PMDK libs to test, separated by comma, Leave blank if not used.'
                required: false
                default: ''
        

env:
    GITHUB_REPO: pmem/pmdk
    DOCKER_REPO: ghcr.io/pmem/pmdk

jobs:
  linux:
    name: Linux
    runs-on: ${{ github.event.inputs.label }}" 
    env:
      # use org's Private Access Token to log in to GitHub Container Registry
      GH_CR_USER:  ${{ secrets.GH_CR_USER }}
      GH_CR_PAT:   ${{ secrets.GH_CR_PAT }}
      DOC_UPDATE_GITHUB_TOKEN: ${{ secrets.DOC_UPDATE_GITHUB_TOKEN }}
      HOST_WORKDIR:   /home/runner/work/pmdk/pmdk
      WORKDIR:        utils/docker
      PMDK_CC:        gcc
      PMDK_CXX:       g++
      MAKE_PKG:       0
      REMOTE_TESTS:   1
      VALGRIND:       1
      SRC_CHECKERS:   0
   
    steps:
        - name: Print configaration data
          run: |
            echo "label: ${{ github.event.inputs.label }}" 
            echo "test_folders: ${{ github.event.inputs.test_folders }}"
            echo "test_type: ${{ github.event.inputs.test_type }}" 
            echo "test_build: ${{ github.event.inputs.test_build }}"
            echo "fs_type: ${{ github.event.inputs.fs_type }}" 
            echo "badblock: ${{ github.event.inputs.badblock }}"
            echo "drd: ${{ github.event.inputs.drd }}" 
            echo "memcheck: ${{ github.event.inputs.memcheck }}"
            echo "helgrind: ${{ github.event.inputs.helgrind }}" 
            echo "dual_exec: ${{ github.event.inputs.dual_exec }}"
            echo "email_recipients: ${{ github.event.inputs.email_recipients }}"
            echo "skip_tests: ${{ github.event.inputs.skip_tests }}" 
            echo "pmdk_libs: ${{ github.event.inputs.pmdk_libs }}"
        - name: Clone the git repo
          uses: actions/checkout@v2
          with:
            fetch-depth: 50


      

     
