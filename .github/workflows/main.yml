# Validate on default OSes.
name: Main

on:
  workflow_dispatch:
  pull_request:

jobs:
  basic_build:
    name: Basic build
    runs-on: ubuntu-latest
    steps:
      - name: Clone the git repo
        uses: actions/checkout@v3

      - name: Install dependencies
        run: sudo apt-get -y install pandoc

      - name: Build sources
        env:
          NDCTL_ENABLE: n # just to speed up the job
        run: make -j$(nproc) test


  call-ubuntu:
    needs: [basic_build]
    uses: ./.github/workflows/ubuntu.yml
    name: Ubuntu

  coverage_scan:
    needs: call-ubuntu
    uses: ./.github/workflows/scan_coverage.yml
    name: Coverage
